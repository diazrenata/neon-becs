---
title: "Form of BSDs workflow"
output: html_notebook
---
# Setup, get data
```{r setup, get community data}
library(neonbecs)
dat <- get_toy_portal_data()

head(dat)

dat_bsd <- dat %>%
  replicatebecs::make_bsd(ln_units = .1)

```

## Plot data

```{r plot data}
dat_bsd$species_mean_mass
bsd_plot <- replicatebecs::plot_bsd(bsd = dat_bsd, bsd_name = "Toy Portal")
print(bsd_plot)
```

# Compare species body size vector to hypothesized distributions

- uniform
- uniform @ log scale
- lognormal
- some kind of clustering?
  - the trouble with the clustering is, any sample so small (n=7!) will have large gaps, and the question is whether the gaps/clusters are more pronounced than wd be generated by a non-clustered distribution.


```{r sample comparison dists}

uniform_sample <- runif(n = nrow(dat_bsd), min = min(dat$individual_sizes), 
                        max = max(dat$individual_sizes))
uniform_log_sample <- runif(n = nrow(dat_bsd), min = log(min(dat$individual_sizes)), max = log(max(dat$individual_sizes)))

lognormal_dist <- fitdistrplus::fitdist(dat_bsd$species_mean_mass, "lnorm")
lognormal_sample <- rlnorm(n = nrow(dat_bsd), meanlog = lognormal_dist$estimate["sdlog"], sdlog = lognormal_dist$estimate["sdlog"]) 

comparisons_linearscale <- data.frame(
  empirical_raw = sort(dat_bsd$species_mean_mass),
  uniform = sort(uniform_sample)
) %>%
  tidyr::gather(key = "distribution", value = "value")

comparisons_logscale <- data.frame(
   empirical_log = log(sort(dat_bsd$species_mean_mass)),
   uniform_log = sort(uniform_log_sample),
  lognormal = sort(lognormal_sample)
) %>%
  tidyr::gather(key = "distribution", value = "value")


linear_comp_plot <- ggplot2::ggplot(data = comparisons_linearscale, 
                                    ggplot2::aes(x = value, y = distribution)) +
  ggplot2::geom_point(data = comparisons_linearscale, inherit.aes = TRUE) +
  ggplot2::theme_bw()

print(linear_comp_plot)

log_comp_plot <-  ggplot2::ggplot(data = comparisons_logscale, 
                                    ggplot2::aes(x = value, y = distribution)) +
  ggplot2::geom_point(data = comparisons_logscale, inherit.aes = TRUE) +
  ggplot2::theme_bw()

print(log_comp_plot)
```


# Individuals approach
